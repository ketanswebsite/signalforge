<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0f172a">
    <meta name="description" content="Educational platform for learning technical analysis and backtesting methodologies. Explore historical market patterns and technical indicators for educational purposes only.">
    <meta name="keywords" content="technical analysis education, backtesting learning, market patterns, educational trading tools, historical data analysis">
    <title>SutrAlgo - Technical Analysis Education Platform</title>

    <!-- Google Material Icons -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link rel="icon" type="image/png" href="/images/favicon.PNG">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700;800;900&family=Work+Sans:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Chart.js and PapaParse -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    
    <!-- Chart.js Financial plugin for candlestick charts -->
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.1.1/dist/chartjs-chart-financial.min.js"></script>
    
    <!-- Required plugins for interactive features -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/2.1.2/chartjs-plugin-annotation.min.js"></script>

    <!-- XSS Protection (load first for security) -->
    <script src="js/xss-protection.js"></script>

    <!-- Shared Utilities -->
    <script src="js/utils/date-formatter.js"></script>

    <!-- Global Error Handler -->
    <script src="js/error-handler.js"></script>

    <!-- Abort Controller Manager -->
    <script src="js/abort-controller-manager.js"></script>

    <!-- Network Retry Logic -->
    <script src="js/network-retry.js"></script>

    <!-- Loading States Manager -->
    <script src="js/loading-states.js"></script>

    <!-- Form Validation -->
    <script src="js/form-validation.js"></script>

    <!-- Accessibility Enhancer -->
    <script src="js/accessibility-enhancer.js"></script>

    <!-- Chart Performance Optimizer -->
    <script src="js/chart-performance.js"></script><!-- Cookie Consent (load early for GDPR compliance) -->
    <script src="js/cookie-consent.js"></script>
    
    <!-- Chart Theme Script -->
    <script src="js/chart-theme.js"></script>

    <!-- ML Insights UI -->
    <script src="js/ml-insights-ui.js" defer></script>

    <!-- Modern CSS -->
    <link rel="stylesheet" href="/css/main.css">

    <!-- Modern Effects (Custom Cursor, Scroll Progress, Animations) -->
    <script src="/js/modern-effects.js" defer></script>

    <!-- Landing Page Animations -->
    <script src="/js/landing.js" defer></script>

    <!-- CORS proxy functionality -->
    <script>
        // Register for a CORS Anywhere API key or use a self-hosted proxy
        // This is needed because Yahoo Finance API doesn't support CORS
        const corsProxyInfo = document.createElement('div');
        corsProxyInfo.id = 'cors-proxy-info';
        corsProxyInfo.style.display = 'none';
        document.head.appendChild(corsProxyInfo);
    </script>
</head>
<body>
    <!-- Animated Background with Particles -->
    <div class="landing-background">
        <div class="gradient-orb orb-1"></div>
        <div class="gradient-orb orb-2"></div>
        <div class="gradient-orb orb-3"></div>
        <canvas id="particles-canvas"></canvas>
    </div>


    <div class="app-container">
        <!-- Navigation bar will be inserted here by unified-navbar.js -->

        <div class="dashboard">
            <!-- Hidden inputs for fixed parameters -->
            <input type="hidden" id="r" value="14">
            <input type="hidden" id="s" value="10">
            <input type="hidden" id="u" value="5">
            <input type="hidden" id="enable-weekly-dti" value="true">
            <input type="hidden" id="entry-threshold" value="0">
            <input type="hidden" id="take-profit" value="8">
            <input type="hidden" id="stop-loss" value="5">
            <input type="hidden" id="max-days" value="30">

            <div class="main-content-wrapper">
                <!-- Methodology Introduction -->
                <div class="methodology-intro">
                    <div class="intro-icon">
                        <span class="material-icons">auto_graph</span>
                    </div>
                    <div class="intro-content">
                        <p>SutrAlgo enhances William Blau's DTI (Directional Trend Indicator) framework, detailed in <em>"Momentum, Direction and Divergence"</em> (1995). Through meticulous calibration, we've amplified the indicator's natural strengths—delivering high-conviction signals that cut through market noise with remarkable clarity.</p>
                    </div>
                </div>

                <!-- Scan Control Panel -->
                <div class="scan-control-panel">
                    <h2 class="scan-title">
                        <span class="material-icons">radar</span>
                        Market Scanner
                    </h2>
                    <div class="scan-controls">
                        <div id="stock-index-selector-container" class="control-group"></div>
                        <div id="batch-process-container" class="control-group"></div>
                    </div>
                    <div id="data-fetch-status" class="scan-status"></div>
                </div>
                <!-- Legal Compliance Disclaimers -->
                <div class="page-header">
                    <!-- UK Regulatory Compliance Disclaimers -->
                    <div class="legal-disclaimer disclaimer">
                        <div class="disclaimer-content">
                            <p><strong>Important Disclaimer:</strong> This service provides informational and educational tools only, not investment advice. The information, data, analysis, and tools provided are for informational and educational purposes only. Nothing contained in our service constitutes investment advice or recommendations.</p>

                            <p><strong>Past Performance Warning:</strong> Past performance is not a reliable indicator of future results. All trading involves risk and you could lose invested capital.</p>

                            <p><strong>Risk Warning:</strong> Technical indicators may produce false signals. Market conditions can change rapidly making historical patterns unreliable. You accept full responsibility for all investment decisions.</p>
                        </div>
                    </div>

                    <div class="disclaimer disclaimer-warning">
                        <div class="disclaimer-title">
                            <span class="material-icons">warning</span>
                            Educational Charts - Risk Warning
                        </div>
                        <div class="disclaimer-content">
                            <p>Past performance is not a reliable indicator of future results. Technical indicators may produce false signals. All information is for educational purposes only, not investment advice.</p>
                        </div>
                    </div>
                </div>

                <!-- Charts Section - All 3 charts stacked vertically on the right -->
                <div class="chart-section">
                <div class="charts-grid">
                    <div class="chart-card scroll-reveal">
                        <div class="chart-header">
                            <div>
                                <h3 class="chart-title">
                                    <span class="material-icons">bar_chart</span>
                                    Price Chart
                                </h3>
                                <p class="chart-subtitle">Historical price movement</p>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="price-chart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card scroll-reveal">
                        <div class="chart-header">
                            <div>
                                <h3 class="chart-title">
                                    <span class="material-icons">show_chart</span>
                                    Primary Indicator
                                </h3>
                                <p class="chart-subtitle">Daily technical signals</p>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="dti-chart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card scroll-reveal">
                        <div class="chart-header">
                            <div>
                                <h3 class="chart-title">
                                    <span class="material-icons">monitor</span>
                                    Secondary Indicator
                                </h3>
                                <p class="chart-subtitle">Weekly technical signals</p>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="weekly-dti-chart"></canvas>
                        </div>
                    </div>
                </div>
                </div>

                <!-- Statistics moved here, after charts -->
                <div class="statistics scroll-reveal" id="statistics">
                    <div class="metric-card">
                        <div class="metric-content">
                            <div class="metric-title">Total Trades</div>
                            <div class="metric-value data-value">0</div>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-content">
                            <div class="metric-title">Win Rate</div>
                            <div class="metric-value data-value">0%</div>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-content">
                            <div class="metric-title">Avg. Profit/Trade</div>
                            <div class="metric-value data-value">0%</div>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-content">
                            <div class="metric-title">Total Return</div>
                            <div class="metric-value data-value">0%</div>
                        </div>
                    </div>
                </div>

                <div class="trades-section scroll-reveal">
                    <div class="trades-header">
                        <h3 class="trades-title">
                            <span class="material-icons icon-sm icon-mr-xs" aria-hidden="true">history</span>
                            Trade History
                        </h3>
                    </div>
                    <div class="table-container">
                        <table id="trades-table">
                            <thead>
                                <tr>
                                    <th>Entry Date</th>
                                    <th>Entry Price</th>
                                    <th>Primary Signal</th>
                                    <th>Secondary Signal</th>
                                    <th>Exit Date</th>
                                    <th>Exit Price</th>
                                    <th>Holding Days</th>
                                    <th>P/L %</th>
                                    <th>Exit Reason</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="9" class="no-data">Select a stock and fetch data to see trade results</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Technical Analysis Patterns Section (will be populated by JavaScript) -->
                <div class="opportunities-section scroll-reveal" id="buying-opportunities">
                    <div class="opportunities-header">
                        <h3 class="opportunities-title">
                            <span class="material-icons">edit</span>
                            Current Technical Patterns
                        </h3>
                    </div>

                    <div class="disclaimer">
                        <div class="disclaimer-content">
                            <p><strong>Educational Information:</strong> Technical patterns shown below are for educational analysis only. Traders often interpret these patterns differently. Past patterns do not guarantee future results.</p>
                        </div>
                    </div>

                    <p class="opportunities-empty">No active technical patterns found. Try adjusting parameters or running a full scan.</p>
                </div>
            </div>
        </div>
    </div>
    <!-- End of .app-container -->

    <!-- Trade management modal placeholder -->
    <div id="trade-modal-placeholder"></div>

    <!-- Notification container -->
    <div id="notification-container"></div><script>
function ensureModulesLoaded(moduleList, callback) {
    const checkInterval = setInterval(() => {
        const allLoaded = moduleList.every(module => 
            window[module] !== undefined);
        
        if (allLoaded) {
            clearInterval(checkInterval);
            callback();
        }
    }, 50);
}

// Example usage
document.addEventListener('DOMContentLoaded', function() {
    ensureModulesLoaded(['DTIBacktester', 'DTIData', 'DTIIndicators', 
        'DTIBacktest', 'DTIUI', 'TradeCore'], function() {
        // Initialize your application here
    });
});
</script>

<!-- Core functionality -->
<!-- API Client -->
<script src="js/api-client.js"></script>
<script src="js/dti-core.js"></script>

<!-- Shared modules (SINGLE SOURCE OF TRUTH) -->
<script src="../lib/shared/stock-data.js"></script>
<script src="../lib/shared/dti-calculator.js"></script>
<script src="../lib/shared/backtest-calculator.js"></script>

<!-- Core data processing and algorithms (load BEFORE UI modules) -->
<script src="js/dti-data.js"></script>
<script src="js/dti-indicators.js"></script>
<script src="js/dti-backtest.js"></script>

<!-- UI modules (depend on core modules above) -->
<script src="js/dti-ui-core.js"></script>
<script src="js/dti-ui-charts.js"></script>
<script src="js/dti-ui-controls.js"></script>
<script src="js/dti-ui-trades.js"></script>
<script src="js/dti-ui-selector.js"></script>

<!-- Performance Modal -->
<script src="js/dti-performance-modal.js"></script>

    <!-- Company Names Mapping -->
    <script src="js/company-names.js"></script>
    
    <!-- Mobile Navigation -->
    <script src="js/mobile-nav.js"></script>
    
    <!-- Trade management modules -->
    <script src="js/trade-core.js"></script>
<!-- Include these in your HTML file in this order -->
<script src="js/TradeUI-Core.js"></script>
<script src="js/TradeUI-Trades.js"></script>
<script src="js/TradeUI-Dialogs.js"></script>
<script src="js/TradeUI-Charts.js"></script>
<script src="js/TradeUI-Export-Metrics.js"></script>
    <!-- Keep existing specialized scripts -->
    <script src="js/trade-modal.js"></script>
    
    <!-- Alerts UI -->
    <script src="js/alerts-ui.js"></script>
    
    <!-- Backtest Alerts -->
    <script src="js/backtest-alerts.js"></script>

    
    <!-- Tab switching functionality for index info -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const indexTabs = document.querySelectorAll('.index-tab');
            const indexContents = document.querySelectorAll('.index-content');
            
            indexTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    indexTabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Hide all content sections
                    indexContents.forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    // Show selected content
                    const index = this.getAttribute('data-index');
                    document.getElementById(`${index}-content`).style.display = 'block';
                    
                    // If index selector exists, also update it
                    const indexSelector = document.getElementById('index-selector');
                    if (indexSelector && indexSelector.value !== index) {
                        indexSelector.value = index;
                        
                        // Manually trigger the change event
                        const event = new Event('change');
                        indexSelector.dispatchEvent(event);
                    }
                });
            });
        });
    </script>
    
    <!-- Legal Footer -->
    <footer class="legal-footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="terms.html" class="footer-link">Terms of Service</a>
                <a href="privacy.html" class="footer-link">Privacy Policy</a>
                <a href="data-management.html" class="footer-link">Data Management</a>
                <span class="footer-text">© 2025 SutrAlgo - Educational tools only, not investment advice</span>
            </div>
            <div class="footer-disclaimer">
                <p>Past performance is not a reliable indicator of future results. You accept full responsibility for all investment decisions.</p>
            </div>
        </div>
    </footer>

<!-- Unified Navigation Bar -->
<script src="js/unified-navbar.js"></script>
</body>
</html>