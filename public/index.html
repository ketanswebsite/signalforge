<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#0f172a">
    <meta name="description" content="Educational platform for learning technical analysis and backtesting methodologies. Explore historical market patterns and technical indicators for educational purposes only.">
    <meta name="keywords" content="technical analysis education, backtesting learning, market patterns, educational trading tools, historical data analysis">
    <title>SutrAlgo - Technical Analysis Education Platform</title>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@400;500;600;700;800;900&family=Work+Sans:wght@300;400;500;600;700&family=Roboto+Mono:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Chart.js and PapaParse -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
    
    <!-- Chart.js Financial plugin for candlestick charts -->
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@0.1.1/dist/chartjs-chart-financial.min.js"></script>
    
    <!-- Required plugins for interactive features -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hammer.js/2.0.8/hammer.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-zoom/2.0.1/chartjs-plugin-zoom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/2.1.2/chartjs-plugin-annotation.min.js"></script>

    <!-- XSS Protection (load first for security) -->
    <script src="js/xss-protection.js"></script>

    <!-- Global Error Handler -->
    <script src="js/error-handler.js"></script>

    <!-- Abort Controller Manager -->
    <script src="js/abort-controller-manager.js"></script>

    <!-- Network Retry Logic -->
    <script src="js/network-retry.js"></script>

    <!-- Loading States Manager -->
    <script src="js/loading-states.js"></script>

    <!-- Form Validation -->
    <script src="js/form-validation.js"></script>

    <!-- Accessibility Enhancer -->
    <script src="js/accessibility-enhancer.js"></script>

    <!-- Chart Performance Optimizer -->
    <script src="js/chart-performance.js"></script>

    <!-- Theme Toggle Script (load early to prevent flash) -->
    <script src="js/theme-toggle.js"></script>

    <!-- Cookie Consent (load early for GDPR compliance) -->
    <script src="js/cookie-consent.js"></script>
    
    <!-- Chart Theme Script -->
    <script src="js/chart-theme.js"></script>

    <!-- ML Insights UI -->
    <script src="js/ml-insights-ui.js" defer></script>

    <!-- Modern CSS -->
    <link rel="stylesheet" href="/css/main.css">

    <!-- Modern Effects (Custom Cursor, Scroll Progress, Animations) -->
    <script src="/js/modern-effects.js" defer></script>

    <!-- CORS proxy functionality -->
    <script>
        // Register for a CORS Anywhere API key or use a self-hosted proxy
        // This is needed because Yahoo Finance API doesn't support CORS
        const corsProxyInfo = document.createElement('div');
        corsProxyInfo.id = 'cors-proxy-info';
        corsProxyInfo.style.display = 'none';
        document.head.appendChild(corsProxyInfo);
    </script>
</head>
<body>
    <!-- Animated decorative background -->
    <div class="page-background">
        <div class="background-gradient"></div>
        <div class="floating-element floating-element-1"></div>
        <div class="floating-element floating-element-2"></div>
        <div class="floating-element floating-element-3"></div>
        <div class="floating-element floating-element-4"></div>
    </div>

    <div class="app-container">
        <!-- Navigation bar will be inserted here by unified-navbar.js -->

        <div class="dashboard">
            <div class="sidebar">
                <h3 class="sidebar-title">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="3"></circle>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                    </svg>
                    Strategy Parameters
                </h3>

                <!-- Hidden inputs for fixed parameters -->
                <input type="hidden" id="r" value="14">
                <input type="hidden" id="s" value="10">
                <input type="hidden" id="u" value="5">
                <input type="hidden" id="enable-weekly-dti" value="true">

                <div class="sidebar-section">
                    <h4 class="sidebar-section-title">Backtest Parameters</h4>
                    <div class="param-controls">
                        <div class="param-group">
                            <label for="entry-threshold" class="param-label">Entry Threshold</label>
                            <input type="number" id="entry-threshold" value="0" max="0" class="param-input">
                            <span class="param-hint">Historical entry point when indicator below this value</span>
                        </div>
                        <div class="param-group">
                            <label for="take-profit" class="param-label">Take Profit (%)</label>
                            <input type="number" id="take-profit" value="8" min="0" step="0.1" class="param-input">
                            <span class="param-hint">Historical exit point at this percentage gain</span>
                        </div>
                        <div class="param-group">
                            <label for="stop-loss" class="param-label">Stop Loss (%)</label>
                            <input type="number" id="stop-loss" value="5" min="0" step="0.1" class="param-input">
                            <span class="param-hint">Historical exit point at this percentage loss</span>
                        </div>
                        <div class="param-group">
                            <label for="max-days" class="param-label">Max Holding Period (days)</label>
                            <input type="number" id="max-days" value="30" min="1" class="param-input">
                            <span class="param-hint">Historical position duration limit for analysis</span>
                        </div>
                    </div>
                </div>

                <div class="sidebar-section">
                    <h4 class="sidebar-section-title">Data Source</h4>
                    <div class="param-controls">
                        <!-- Stock index and selector will be added here by JavaScript -->
                        <div id="data-fetch-status" class="param-hint"></div>
                        <!-- Batch process button will be added here by JavaScript -->
                        <!-- Batch status indicator will be added here by JavaScript -->
                    </div>
                </div>
            </div>
            
            <div class="main-content-wrapper">
                <!-- App Description and Legal Compliance -->
                <div class="page-header">
                    <p class="app-description">
                        Educational platform for learning technical analysis and backtesting methodologies.
                        Explore historical market patterns and understand technical indicators through interactive data visualization.
                    </p>

                    <!-- UK Regulatory Compliance Disclaimers -->
                    <div class="legal-disclaimer disclaimer">
                        <div class="disclaimer-content">
                            <p><strong>Important Disclaimer:</strong> This service provides informational and educational tools only, not investment advice. The information, data, analysis, and tools provided are for informational and educational purposes only. Nothing contained in our service constitutes investment advice or recommendations.</p>

                            <p><strong>Past Performance Warning:</strong> Past performance is not a reliable indicator of future results. All trading involves risk and you could lose invested capital.</p>

                            <p><strong>Risk Warning:</strong> Technical indicators may produce false signals. Market conditions can change rapidly making historical patterns unreliable. You accept full responsibility for all investment decisions.</p>
                        </div>
                    </div>
                </div>

                <div class="disclaimer disclaimer-warning">
                    <div class="disclaimer-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path>
                            <line x1="12" y1="9" x2="12" y2="13"></line>
                            <line x1="12" y1="17" x2="12.01" y2="17"></line>
                        </svg>
                        Educational Charts - Risk Warning
                    </div>
                    <div class="disclaimer-content">
                        <p>Past performance is not a reliable indicator of future results. Technical indicators may produce false signals. All information is for educational purposes only, not investment advice.</p>
                    </div>
                </div>

                <div class="chart-section">
                <div class="charts-grid">
                    <div class="chart-card scroll-reveal">
                        <div class="chart-header">
                            <div>
                                <h3 class="chart-title">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <line x1="18" y1="20" x2="18" y2="10"></line>
                                        <line x1="12" y1="20" x2="12" y2="4"></line>
                                        <line x1="6" y1="20" x2="6" y2="14"></line>
                                    </svg>
                                    Price Chart
                                </h3>
                                <p class="chart-subtitle">Historical price movement</p>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="price-chart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card scroll-reveal">
                        <div class="chart-header">
                            <div>
                                <h3 class="chart-title">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                                    </svg>
                                    Primary Indicator
                                </h3>
                                <p class="chart-subtitle">Daily technical signals</p>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="dti-chart"></canvas>
                        </div>
                    </div>

                    <div class="chart-card scroll-reveal">
                        <div class="chart-header">
                            <div>
                                <h3 class="chart-title">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                        <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                                        <line x1="8" y1="21" x2="16" y2="21"></line>
                                        <line x1="12" y1="17" x2="12" y2="21"></line>
                                    </svg>
                                    Secondary Indicator
                                </h3>
                                <p class="chart-subtitle">Weekly technical signals</p>
                            </div>
                        </div>
                        <div class="chart-container">
                            <canvas id="weekly-dti-chart"></canvas>
                        </div>
                    </div>
                </div>
                </div>

                <div class="disclaimer disclaimer-info">
                    <div class="disclaimer-title">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="16" x2="12" y2="12"></line>
                            <line x1="12" y1="8" x2="12.01" y2="8"></line>
                        </svg>
                        Simulated Performance Warning
                    </div>
                    <div class="disclaimer-content">
                        <p>Figures refer to simulated past performance and past performance is not a reliable indicator of future performance. Results may not reflect actual trading due to factors including market impact, slippage, and fees.</p>
                    </div>
                </div>

                <div class="statistics scroll-reveal" id="statistics">
                    <div class="metric-card">
                        <div class="metric-content">
                            <div class="metric-title">Total Trades</div>
                            <div class="metric-value data-value">0</div>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-content">
                            <div class="metric-title">Win Rate</div>
                            <div class="metric-value data-value">0%</div>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-content">
                            <div class="metric-title">Avg. Profit/Trade</div>
                            <div class="metric-value data-value">0%</div>
                        </div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-content">
                            <div class="metric-title">Total Return</div>
                            <div class="metric-value data-value">0%</div>
                        </div>
                    </div>
                </div>

                <div class="trades-section scroll-reveal">
                    <div class="trades-header">
                        <h3 class="trades-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                                <circle cx="12" cy="7" r="4"></circle>
                            </svg>
                            Trade History
                        </h3>
                    </div>
                    <div class="table-container">
                        <table id="trades-table">
                            <thead>
                                <tr>
                                    <th>Entry Date</th>
                                    <th>Entry Price</th>
                                    <th>Primary Signal</th>
                                    <th>Secondary Signal</th>
                                    <th>Exit Date</th>
                                    <th>Exit Price</th>
                                    <th>Holding Days</th>
                                    <th>P/L %</th>
                                    <th>Exit Reason</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="9" class="no-data">Select a stock and fetch data to see trade results</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <!-- Technical Analysis Patterns Section (will be populated by JavaScript) -->
                <div class="opportunities-section scroll-reveal" id="buying-opportunities">
                    <div class="opportunities-header">
                        <h3 class="opportunities-title">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polygon points="14 2 18 6 7 17 3 17 3 13 14 2"></polygon>
                                <line x1="3" y1="22" x2="21" y2="22"></line>
                            </svg>
                            Current Technical Patterns
                        </h3>
                    </div>

                    <div class="disclaimer">
                        <div class="disclaimer-content">
                            <p><strong>Educational Information:</strong> Technical patterns shown below are for educational analysis only. Traders often interpret these patterns differently. Past patterns do not guarantee future results.</p>
                        </div>
                    </div>

                    <p class="opportunities-empty">No active technical patterns found. Try adjusting parameters or running a full scan.</p>
                </div>
            </div>
        </div>
    </div>
    <!-- End of .app-container -->

    <!-- Trade management modal placeholder -->
    <div id="trade-modal-placeholder"></div>

    <!-- Notification container -->
    <div id="notification-container"></div>

    <!-- Dark Mode Toggle -->
    <button class="theme-toggle" id="theme-toggle" aria-label="Toggle dark mode">
        <svg class="sun-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
        </svg>
        <svg class="moon-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
        </svg>
    </button>
    

<script>
function ensureModulesLoaded(moduleList, callback) {
    const checkInterval = setInterval(() => {
        const allLoaded = moduleList.every(module => 
            window[module] !== undefined);
        
        if (allLoaded) {
            clearInterval(checkInterval);
            callback();
        }
    }, 50);
}

// Example usage
document.addEventListener('DOMContentLoaded', function() {
    ensureModulesLoaded(['DTIBacktester', 'DTIData', 'DTIIndicators', 
        'DTIBacktest', 'DTIUI', 'TradeCore'], function() {
        // Initialize your application here
    });
});
</script>

<!-- Core functionality -->
<!-- API Client -->
<script src="js/api-client.js"></script>
<script src="js/dti-core.js"></script>

<!-- Shared modules (SINGLE SOURCE OF TRUTH) -->
<script src="../lib/shared/stock-data.js"></script>
<script src="../lib/shared/dti-calculator.js"></script>
<script src="../lib/shared/backtest-calculator.js"></script>

<!-- Core data processing and algorithms (load BEFORE UI modules) -->
<script src="js/dti-data.js"></script>
<script src="js/dti-indicators.js"></script>
<script src="js/dti-backtest.js"></script>

<!-- UI modules (depend on core modules above) -->
<script src="js/dti-ui-core.js"></script>
<script src="js/dti-ui-charts.js"></script>
<script src="js/dti-ui-controls.js"></script>
<script src="js/dti-ui-trades.js"></script>
<script src="js/dti-ui-selector.js"></script>

<!-- Performance Modal -->
<script src="js/dti-performance-modal.js"></script>

    <!-- Company Names Mapping -->
    <script src="js/company-names.js"></script>
    
    <!-- Mobile Navigation -->
    <script src="js/mobile-nav.js"></script>
    
    <!-- Trade management modules -->
    <script src="js/trade-core.js"></script>
<!-- Include these in your HTML file in this order -->
<script src="js/TradeUI-Core.js"></script>
<script src="js/TradeUI-Trades.js"></script>
<script src="js/TradeUI-Dialogs.js"></script>
<script src="js/TradeUI-Charts.js"></script>
<script src="js/TradeUI-Export-Metrics.js"></script>
    <!-- Keep existing specialized scripts -->
    <script src="js/trade-modal.js"></script>
    
    <!-- Alerts UI -->
    <script src="js/alerts-ui.js"></script>
    
    <!-- Backtest Alerts -->
    <script src="js/backtest-alerts.js"></script>

    
    <!-- Tab switching functionality for index info -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const indexTabs = document.querySelectorAll('.index-tab');
            const indexContents = document.querySelectorAll('.index-content');
            
            indexTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    // Remove active class from all tabs
                    indexTabs.forEach(t => t.classList.remove('active'));
                    
                    // Add active class to clicked tab
                    this.classList.add('active');
                    
                    // Hide all content sections
                    indexContents.forEach(content => {
                        content.style.display = 'none';
                    });
                    
                    // Show selected content
                    const index = this.getAttribute('data-index');
                    document.getElementById(`${index}-content`).style.display = 'block';
                    
                    // If index selector exists, also update it
                    const indexSelector = document.getElementById('index-selector');
                    if (indexSelector && indexSelector.value !== index) {
                        indexSelector.value = index;
                        
                        // Manually trigger the change event
                        const event = new Event('change');
                        indexSelector.dispatchEvent(event);
                    }
                });
            });
        });
    </script>
    
    <!-- Legal Footer -->
    <footer class="legal-footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="terms.html" class="footer-link">Terms of Service</a>
                <a href="privacy.html" class="footer-link">Privacy Policy</a>
                <span class="footer-text">© 2025 SutrAlgo - Educational tools only, not investment advice</span>
            </div>
            <div class="footer-disclaimer">
                <p>Past performance is not a reliable indicator of future results. You accept full responsibility for all investment decisions.</p>
            </div>
        </div>
    </footer>

<!-- Unified Navigation Bar -->
<script src="js/unified-navbar.js"></script>
</body>
</html>